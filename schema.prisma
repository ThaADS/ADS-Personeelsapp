generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Tenant {
  id                   String               @id @default(uuid()) @db.Uuid
  name                 String
  slug                 String               @unique
  domain               String?              @unique
  logo                 String?
  contactEmail         String               @map("contact_email")
  contactName          String               @map("contact_name")
  address              String?
  phone                String?
  settings             Json?                @default("{}")
  subscriptionStatus   subscription_status? @default(TRIAL) @map("subscription_status")
  currentPlan          plan_type?           @default(FREEMIUM) @map("current_plan")
  stripeCustomerId     String?              @unique @map("stripe_customer_id")
  stripeSubscriptionId String?              @unique @map("stripe_subscription_id")
  trialEndsAt          DateTime?            @map("trial_ends_at") @db.Timestamptz(6)
  // Suspension and archival tracking
  suspendedAt          DateTime?            @map("suspended_at") @db.Timestamptz(6)
  suspendedBy          String?              @map("suspended_by") @db.Uuid
  suspensionReason     String?              @map("suspension_reason")
  isArchived           Boolean?             @default(false) @map("is_archived")
  archivedAt           DateTime?            @map("archived_at") @db.Timestamptz(6)
  archivedBy           String?              @map("archived_by") @db.Uuid
  createdAt            DateTime?            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime?            @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  auditLogs            AuditLog[]
  departments          departments[]
  documents            documents[]
  employees            employees[]
  invitations          Invitation[]
  leave_balances       LeaveBalance[]
  leaveRequests        LeaveRequest[]
  notifications        notifications[]
  public_holidays      public_holidays[]
  sick_leaves          sick_leaves[]
  subscriptions        Subscription[]
  tenantUsers          TenantUser[]
  timesheets           Timesheet[]
  vacations            vacations[]
  work_schedules       work_schedules[]
  routeVisionConfig    RouteVisionConfig?

  @@index([domain], map: "idx_tenants_domain")
  @@index([slug], map: "idx_tenants_slug")
  @@index([stripeCustomerId], map: "idx_tenants_stripe_customer_id")
  @@map("tenants")
}

model User {
  id                                       String                  @id @default(uuid()) @db.Uuid
  name                                     String?
  email                                    String                  @unique
  emailVerified                            DateTime?               @map("email_verified") @db.Timestamptz(6)
  image                                    String?
  role                                     String?                 @default("USER")
  isSuperuser                              Boolean?                @default(false) @map("is_superuser")
  createdAt                                DateTime?               @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                                DateTime?               @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  password                                 String?
  locale                                   String?                 @default("nl") @db.VarChar(10)
  phone                                    String?                 @db.VarChar(50)
  address                                  String?
  city                                     String?                 @db.VarChar(100)
  postalCode                               String?                 @map("postal_code") @db.VarChar(20)
  employeeId                               String?                 @map("employee_id") @db.VarChar(50)
  department                               String?                 @db.VarChar(100)
  position                                 String?                 @db.VarChar(100)
  startDate                                DateTime?               @map("start_date") @db.Timestamptz(6)
  contractType                             String?                 @map("contract_type") @db.VarChar(50)
  workHoursPerWeek                         Float?                  @map("work_hours_per_week")
  // Additional personal details
  dateOfBirth                              DateTime?               @map("date_of_birth") @db.Date
  gender                                   String?                 @db.VarChar(20)
  nationality                              String?                 @db.VarChar(50)
  maritalStatus                            String?                 @map("marital_status") @db.VarChar(30)
  // Bank details for payroll
  bankAccountNumber                        String?                 @map("bank_account_number") @db.VarChar(50)
  bankAccountName                          String?                 @map("bank_account_name") @db.VarChar(100)
  // BSN for Dutch employees
  bsnNumber                                String?                 @map("bsn_number") @db.VarChar(20)
  auditLogs                                AuditLog[]
  departments                              departments[]
  documents                                documents[]
  employees                                employees?
  invitations                              Invitation[]
  leaveRequests                            LeaveRequest[]
  notificationPreference                   NotificationPreference?
  notifications                            notifications[]
  tenantUsers                              TenantUser[]
  timesheets_timesheets_approved_byTousers Timesheet[]             @relation("timesheets_approved_byTousers")
  timesheets                               Timesheet[]
  vacations                                vacations[]

  @@index([email], map: "idx_users_email")
  @@index([role], map: "idx_users_role")
  @@map("users")
}

model TenantUser {
  id        String    @id @default(uuid()) @db.Uuid
  tenantId  String    @map("tenant_id") @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  role      String?   @default("USER")
  isActive  Boolean?  @default(true) @map("is_active")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenantId, userId])
  @@index([role], map: "idx_tenant_users_role")
  @@index([tenantId], map: "idx_tenant_users_tenant_id")
  @@index([userId], map: "idx_tenant_users_user_id")
  @@map("tenant_users")
}

model Plan {
  id                String         @id @default(uuid()) @db.Uuid
  name              String         @unique
  type              plan_type
  price             Decimal        @db.Decimal(10, 2)
  yearlyPrice       Decimal?       @map("yearly_price") @db.Decimal(10, 2)
  includedUsers     Int?           @default(3) @map("included_users")
  pricePerExtraUser Decimal?       @default(4.95) @map("price_per_extra_user") @db.Decimal(10, 2)
  features          Json?          @default("[]")
  isActive          Boolean?       @default(true) @map("is_active")
  createdAt         DateTime?      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?      @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  subscriptions     Subscription[]

  @@map("plans")
}

model Subscription {
  id                   String              @id @default(uuid()) @db.Uuid
  tenantId             String              @map("tenant_id") @db.Uuid
  planId               String              @map("plan_id") @db.Uuid
  stripeSubscriptionId String              @unique @map("stripe_subscription_id")
  stripePriceId        String              @map("stripe_price_id")
  status               subscription_status
  currentPeriodStart   DateTime            @map("current_period_start") @db.Timestamptz(6)
  currentPeriodEnd     DateTime            @map("current_period_end") @db.Timestamptz(6)
  trialEnd             DateTime?           @map("trial_end") @db.Timestamptz(6)
  userCount            Int?                @default(3) @map("user_count")
  createdAt            DateTime?           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime?           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  plan                 Plan                @relation(fields: [planId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenant               Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenantId], map: "idx_subscriptions_tenant_id")
  @@index([status], map: "idx_subscriptions_status")
  @@map("subscriptions")
}

model Invitation {
  id         String     @id @default(uuid()) @db.Uuid
  tenantId   String     @map("tenant_id") @db.Uuid
  email      String
  role       user_role? @default(USER)
  token      String     @unique
  expiresAt  DateTime   @map("expires_at") @db.Timestamptz(6)
  usedAt     DateTime?  @map("used_at") @db.Timestamptz(6)
  invited_by String?    @db.Uuid
  createdAt  DateTime?  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime?  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  users      User?      @relation(fields: [invited_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenant     Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenantId, email])
  @@map("invitations")
}

model Advertisement {
  id                String    @id @default(uuid()) @db.Uuid
  title             String
  content           String
  imageUrl          String?   @map("image_url")
  linkUrl           String?   @map("link_url")
  type              ad_type?  @default(BANNER)
  isActive          Boolean?  @default(true) @map("is_active")
  priority          Int?      @default(0)
  startDate         DateTime? @map("start_date") @db.Timestamptz(6)
  endDate           DateTime? @map("end_date") @db.Timestamptz(6)
  target_tenant_ids String[]  @db.Uuid
  createdAt         DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@map("advertisements")
}

model AuditLog {
  id         String    @id @default(uuid()) @db.Uuid
  tenantId   String?   @map("tenant_id") @db.Uuid
  userId     String?   @map("user_id") @db.Uuid
  action     String
  resource   String?
  resourceId String?   @map("resource_id") @db.Uuid
  oldValues  Json?     @map("old_values")
  newValues  Json?     @map("new_values")
  ipAddress  String?   @map("ip_address") @db.Inet
  userAgent  String?   @map("user_agent")
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  tenant     Tenant?   @relation(fields: [tenantId], references: [id], onUpdate: NoAction)
  user       User?     @relation(fields: [userId], references: [id], onUpdate: NoAction)

  @@index([action], map: "idx_audit_logs_action")
  @@index([createdAt], map: "idx_audit_logs_created_at")
  @@index([tenantId], map: "idx_audit_logs_tenant_id")
  @@index([userId], map: "idx_audit_logs_user_id")
  @@map("audit_logs")
}

model Timesheet {
  id                                  String            @id @default(uuid()) @db.Uuid
  tenantId                            String            @map("tenant_id") @db.Uuid
  userId                              String            @map("user_id") @db.Uuid
  date                                DateTime          @db.Date
  startTime                           DateTime          @map("start_time") @db.Timestamptz(6)
  endTime                             DateTime          @map("end_time") @db.Timestamptz(6)
  break_minutes                       Int?              @default(0)
  description                         String?
  total_hours                         Decimal?          @db.Decimal(5, 2)
  status                              timesheet_status? @default(PENDING)
  approved_by                         String?           @db.Uuid
  approved_at                         DateTime?         @db.Timestamptz(6)
  rejection_reason                    String?
  location_start                      Json?
  location_end                        Json?
  createdAt                           DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                           DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  users_timesheets_approved_byTousers User?             @relation("timesheets_approved_byTousers", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenant                              Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user                                User              @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([date], map: "idx_timesheets_date")
  @@index([status], map: "idx_timesheets_status")
  @@index([tenantId, date], map: "idx_timesheets_tenant_date")
  @@index([tenantId], map: "idx_timesheets_tenant_id")
  @@index([userId], map: "idx_timesheets_user_id")
  @@map("timesheets")
}

model NotificationPreference {
  id                       String    @id @default(uuid()) @db.Uuid
  userId                   String    @unique @map("user_id") @db.Uuid
  email_vacation_approved  Boolean?  @default(true)
  email_vacation_rejected  Boolean?  @default(true)
  email_sick_leave_uwv     Boolean?  @default(true)
  email_timesheet_reminder Boolean?  @default(true)
  email_approval_pending   Boolean?  @default(true)
  email_leave_expiring     Boolean?  @default(true)
  in_app_all               Boolean?  @default(true)
  created_at               DateTime? @default(now()) @db.Timestamptz(6)
  updated_at               DateTime? @default(now()) @db.Timestamptz(6)
  user                     User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("notification_preferences")
}

model LeaveBalance {
  id                  String    @id @default(uuid()) @db.Uuid
  tenant_id           String    @db.Uuid
  employee_id         String    @db.Uuid
  year                Int
  statutory_days      Decimal?  @default("20")
  statutory_used      Decimal?  @default("0")
  statutory_expiry    DateTime? @db.Date
  extra_days          Decimal?  @default("5")
  extra_used          Decimal?  @default("0")
  extra_expiry        DateTime? @db.Date
  compensation_hours  Decimal?  @default("0")
  compensation_used   Decimal?  @default("0")
  compensation_expiry DateTime? @db.Date
  special_leave       Decimal?  @default("0")
  special_leave_used  Decimal?  @default("0")
  created_at          DateTime? @default(now()) @db.Timestamptz(6)
  updatedAt           DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  employees           employees @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants             Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, employee_id, year])
  @@map("leave_balances")
}

model LeaveRequest {
  id          String    @id @default(uuid()) @db.Uuid
  tenantId    String    @map("tenant_id") @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  type        String
  startDate   DateTime  @map("start_date") @db.Timestamp(6)
  endDate     DateTime  @map("end_date") @db.Timestamp(6)
  totalDays   Float     @map("total_days")
  description String?
  status      String?   @default("PENDING")
  reviewedBy  String?   @map("reviewed_by") @db.Uuid
  reviewedAt  DateTime? @map("reviewed_at") @db.Timestamp(6)
  reviewNotes String?   @map("review_notes")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenantId], map: "idx_leave_requests_tenant_id")
  @@index([userId], map: "idx_leave_requests_user_id")
  @@index([status], map: "idx_leave_requests_status")
  @@index([startDate, endDate], map: "idx_leave_requests_dates")
  @@map("leave_requests")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model departments {
  id         String      @id @default(uuid()) @db.Uuid
  tenant_id  String      @db.Uuid
  name       String
  code       String?
  manager_id String?     @db.Uuid
  created_at DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at DateTime?   @default(now()) @db.Timestamptz(6)
  users      User?       @relation(fields: [manager_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenants    Tenant      @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  employees  employees[]

  @@unique([tenant_id, name])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model documents {
  id           String        @id @default(uuid()) @db.Uuid
  tenant_id    String        @db.Uuid
  employee_id  String?       @db.Uuid
  type         document_type
  name         String
  file_name    String
  file_size    Int
  mime_type    String
  storage_path String
  uploaded_by  String        @db.Uuid
  created_at   DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at   DateTime?     @default(now()) @db.Timestamptz(6)
  employees    employees?    @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants      Tenant        @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users        User          @relation(fields: [uploaded_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([employee_id], map: "idx_documents_employee_id")
  @@index([tenant_id], map: "idx_documents_tenant_id")
  @@index([type], map: "idx_documents_type")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model employees {
  id                      String           @id @default(uuid()) @db.Uuid
  user_id                 String           @unique @db.Uuid
  tenant_id               String           @db.Uuid
  department_id           String?          @db.Uuid
  employee_number         String?
  position                String?
  contract_type           contract_type?   @default(FULLTIME)
  hours_per_week          Decimal?         @default("40")
  start_date              DateTime         @db.Date
  end_date                DateTime?        @db.Date
  phone_number            String?
  // Emergency contact details
  emergency_contact       String?
  emergency_phone         String?
  emergency_relationship  String?          @db.VarChar(50)
  // Employment details
  hourly_rate             Decimal?         @db.Decimal(10, 2)
  manager_id              String?          @db.Uuid
  cost_center             String?          @db.VarChar(50)
  // Skills and qualifications
  skills                  String[]         @default([])
  certifications          String[]         @default([])
  education_level         String?          @db.VarChar(100)
  languages               String[]         @default([])
  // Work preferences
  remote_work_allowed     Boolean?         @default(false)
  work_location           String?          @db.VarChar(100)
  // Notes
  notes                   String?
  created_at              DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at              DateTime?        @default(now()) @db.Timestamptz(6)
  documents         documents[]
  departments       departments?     @relation(fields: [department_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenants           Tenant           @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users             User             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  leave_balances    LeaveBalance[]
  sick_leaves       sick_leaves[]
  vacations         vacations[]
  work_schedules    work_schedules[]
  vehicleMappings   VehicleMapping[]

  @@unique([tenant_id, employee_number])
  @@index([department_id], map: "idx_employees_department_id")
  @@index([tenant_id], map: "idx_employees_tenant_id")
  @@index([user_id], map: "idx_employees_user_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model notifications {
  id         String            @id @default(uuid()) @db.Uuid
  tenant_id  String?           @db.Uuid
  user_id    String            @db.Uuid
  type       notification_type
  title      String
  message    String
  data       Json?             @default("{}")
  is_read    Boolean?          @default(false)
  read_at    DateTime?         @db.Timestamptz(6)
  action_url String?
  created_at DateTime?         @default(now()) @db.Timestamptz(6)
  tenants    Tenant?           @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      User              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id], map: "idx_notifications_tenant_id")
  @@index([user_id], map: "idx_notifications_user_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model public_holidays {
  id          String   @id @default(uuid()) @db.Uuid
  tenant_id   String?  @db.Uuid
  date        DateTime @db.Date
  name        String
  is_national Boolean? @default(true)
  tenants     Tenant?  @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, date])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model sick_leaves {
  id                   String             @id @default(uuid()) @db.Uuid
  tenant_id            String             @db.Uuid
  employee_id          String             @db.Uuid
  start_date           DateTime           @db.Date
  end_date             DateTime?          @db.Date
  reason               String?
  medical_certificate  Boolean?           @default(false)
  uwv_reported         Boolean?           @default(false)
  uwv_reported_at      DateTime?          @db.Timestamptz(6)
  uwv_report_deadline  DateTime?          @db.Date
  expected_return_date DateTime?          @db.Date
  actual_return_date   DateTime?          @db.Date
  status               sick_leave_status? @default(ACTIVE)
  recovery_percentage  Int?
  created_at           DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?          @default(now()) @db.Timestamptz(6)
  employees            employees          @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants              Tenant             @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([employee_id], map: "idx_sick_leaves_employee_id")
  @@index([status], map: "idx_sick_leaves_status")
  @@index([tenant_id], map: "idx_sick_leaves_tenant_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model vacations {
  id               String           @id @default(uuid()) @db.Uuid
  tenant_id        String           @db.Uuid
  employee_id      String           @db.Uuid
  type             vacation_type?   @default(VACATION)
  start_date       DateTime         @db.Date
  end_date         DateTime         @db.Date
  total_days       Decimal          @db.Decimal(5, 2)
  description      String?
  status           vacation_status? @default(PENDING)
  approved_by      String?          @db.Uuid
  approved_at      DateTime?        @db.Timestamptz(6)
  rejection_reason String?
  created_at       DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?        @default(now()) @db.Timestamptz(6)
  users            User?            @relation(fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees        employees        @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants          Tenant           @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([start_date, end_date], map: "idx_vacations_dates")
  @@index([employee_id], map: "idx_vacations_employee_id")
  @@index([status], map: "idx_vacations_status")
  @@index([tenant_id], map: "idx_vacations_tenant_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model work_schedules {
  id            String    @id @default(uuid()) @db.Uuid
  tenant_id     String    @db.Uuid
  employee_id   String    @db.Uuid
  day_of_week   Int
  start_time    DateTime  @db.Time(6)
  end_time      DateTime  @db.Time(6)
  break_minutes Int?      @default(30)
  is_work_day   Boolean?  @default(true)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)
  employees     employees @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, employee_id, day_of_week])
}

enum ad_type {
  BANNER
  MODAL
  SIDEBAR
}

enum contract_type {
  FULLTIME
  PARTTIME
  FLEX
  TEMPORARY
  INTERN
}

enum document_type {
  CONTRACT
  ID
  CERTIFICATE
  MEDICAL
  OTHER
}

enum notification_type {
  VACATION_REQUESTED
  VACATION_APPROVED
  VACATION_REJECTED
  SICK_LEAVE_REPORTED
  SICK_LEAVE_UWV_DEADLINE
  TIMESHEET_REMINDER
  APPROVAL_PENDING
  LEAVE_EXPIRING
  SYSTEM
}

enum plan_type {
  FREEMIUM
  STANDARD
}

enum sick_leave_status {
  ACTIVE
  RECOVERED
  PARTIAL
}

enum subscription_status {
  TRIAL
  ACTIVE
  FREEMIUM
  CANCELED
  PAST_DUE
  UNPAID
  SUSPENDED
}

enum timesheet_status {
  PENDING
  APPROVED
  REJECTED
}

enum user_role {
  SUPERUSER
  TENANT_ADMIN
  MANAGER
  USER
}

enum vacation_status {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum vacation_type {
  VACATION
  LEAVE
  COMPENSATION
  SPECIAL
  UNPAID
}

// Password Reset Tokens - secure database storage for reset tokens
model PasswordResetToken {
  id          String    @id @default(uuid()) @db.Uuid
  email       String
  token       String    @unique // hashed token
  expiresAt   DateTime  @map("expires_at") @db.Timestamptz(6)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  usedAt      DateTime? @map("used_at") @db.Timestamptz(6)

  @@index([email], map: "idx_password_reset_tokens_email")
  @@index([expiresAt], map: "idx_password_reset_tokens_expires_at")
  @@map("password_reset_tokens")
}

// Rate Limiting - database storage for rate limit tracking
model RateLimitEntry {
  id            String   @id @default(uuid()) @db.Uuid
  identifier    String   // email or IP address
  type          String   // 'password_reset', 'login', etc.
  count         Int      @default(1)
  firstRequest  DateTime @map("first_request") @db.Timestamptz(6)
  windowExpires DateTime @map("window_expires") @db.Timestamptz(6)

  @@unique([identifier, type])
  @@index([windowExpires], map: "idx_rate_limit_entries_window_expires")
  @@map("rate_limit_entries")
}

// RouteVision Integration - Per-tenant configuration for RouteVision API
// LEGACY: Kept for backwards compatibility, new integrations use FleetProviderConfig
model RouteVisionConfig {
  id            String    @id @default(uuid()) @db.Uuid
  tenant_id     String    @unique @db.Uuid
  api_email     String    // Encrypted email for RouteVision API
  api_password  String    // Encrypted password for RouteVision API
  sync_enabled  Boolean   @default(false)
  last_sync     DateTime? @db.Timestamptz(6)
  sync_interval Int       @default(60) // Minutes between syncs
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  updated_at    DateTime  @default(now()) @updatedAt @db.Timestamptz(6)
  tenant        Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sync_enabled], map: "idx_routevision_config_sync_enabled")
  @@map("routevision_configs")
}

// Fleet Provider Configuration - Generic config for all fleet tracking providers
model FleetProviderConfig {
  id              String    @id @default(uuid()) @db.Uuid
  tenant_id       String    @db.Uuid
  provider_type   String    // routevision, fleetgo, samsara, webfleet, trackjack, verizon
  display_name    String?   // Custom name for this integration

  // Credentials (encrypted)
  credentials     Json      // { email?, password?, apiKey?, apiSecret?, customFields? }

  // Sync settings
  sync_enabled    Boolean   @default(false)
  sync_interval   Int       @default(60) // Minutes between syncs
  last_sync       DateTime? @db.Timestamptz(6)
  last_sync_error String?

  // Status
  is_active       Boolean   @default(true)
  connection_status String  @default("unconfigured") // unconfigured, connected, error

  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime  @default(now()) @updatedAt @db.Timestamptz(6)

  @@unique([tenant_id, provider_type])
  @@index([tenant_id], map: "idx_fleet_provider_config_tenant_id")
  @@index([provider_type], map: "idx_fleet_provider_config_provider_type")
  @@index([sync_enabled], map: "idx_fleet_provider_config_sync_enabled")
  @@map("fleet_provider_configs")
}

// Vehicle Mapping - Links fleet provider vehicles to employees
model VehicleMapping {
  id              String     @id @default(uuid()) @db.Uuid
  tenant_id       String     @db.Uuid
  provider_type   String     @default("routevision") // Provider type for this vehicle
  provider_vehicle_id String // Vehicle ID from the provider (was routevision_id)
  registration    String     // License plate (kenteken)
  vehicle_name    String?    // Optional friendly name
  employee_id     String?    @db.Uuid
  is_active       Boolean    @default(true)
  created_at      DateTime   @default(now()) @db.Timestamptz(6)
  updated_at      DateTime   @default(now()) @updatedAt @db.Timestamptz(6)
  employee        employees? @relation(fields: [employee_id], references: [id], onDelete: SetNull, onUpdate: NoAction)

  // Keep routevision_id as computed/alias for backwards compatibility
  routevision_id  String?    // DEPRECATED: Use provider_vehicle_id instead

  @@unique([tenant_id, provider_type, provider_vehicle_id])
  @@index([tenant_id], map: "idx_vehicle_mapping_tenant_id")
  @@index([employee_id], map: "idx_vehicle_mapping_employee_id")
  @@index([provider_type], map: "idx_vehicle_mapping_provider_type")
  @@map("vehicle_mappings")
}

// Trip Record - Synchronized trips from fleet providers
model TripRecord {
  id                  String    @id @default(uuid()) @db.Uuid
  tenant_id           String    @db.Uuid
  provider_type       String    @default("routevision") // Provider that synced this trip
  provider_trip_id    String    // External ID from provider
  vehicle_id          String    // Provider vehicle ID
  registration        String    // License plate
  driver_name         String?   // Driver name from provider
  employee_id         String?   @db.Uuid

  departure_time      DateTime  @db.Timestamptz(6)
  arrival_time        DateTime  @db.Timestamptz(6)
  distance_km         Decimal   @db.Decimal(10, 2)
  duration_minutes    Int

  // Departure location
  departure_street    String?
  departure_house_nr  String?
  departure_postal    String?
  departure_city      String?
  departure_address   String    // Full formatted address
  departure_lat       Float?    // GPS latitude
  departure_lng       Float?    // GPS longitude

  // Arrival location
  arrival_street      String?
  arrival_house_nr    String?
  arrival_postal      String?
  arrival_city        String?
  arrival_address     String    // Full formatted address
  arrival_lat         Float?    // GPS latitude
  arrival_lng         Float?    // GPS longitude

  // Trip flags
  is_private          Boolean   @default(false)
  is_commute          Boolean   @default(false)
  is_manual           Boolean   @default(false)
  is_correction       Boolean   @default(false)

  // Link to timesheet (auto-matched)
  timesheet_id        String?   @db.Uuid

  // Legacy field for backwards compatibility
  routevision_trip_id String?   @unique // DEPRECATED: Use provider_trip_id

  synced_at           DateTime  @default(now()) @db.Timestamptz(6)
  created_at          DateTime  @default(now()) @db.Timestamptz(6)
  updated_at          DateTime  @default(now()) @updatedAt @db.Timestamptz(6)

  @@unique([tenant_id, provider_type, provider_trip_id])
  @@index([tenant_id, departure_time], map: "idx_trip_records_tenant_departure")
  @@index([employee_id], map: "idx_trip_records_employee_id")
  @@index([timesheet_id], map: "idx_trip_records_timesheet_id")
  @@index([vehicle_id], map: "idx_trip_records_vehicle_id")
  @@index([provider_type], map: "idx_trip_records_provider_type")
  @@map("trip_records")
}
